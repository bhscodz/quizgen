<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/3261/3261190.png">
  <link rel="stylesheet" href="https://cdnjs.cloudgflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <title>Quiz Room | QUIZGEN</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 5vw;
    }

    #quiz-room {
      width: 90%;
      max-width: 800px;
      margin: 0 auto;
      background: #1e1e1e;
      padding: 5vw;
      border-radius: 3vw;
      box-shadow: 0 0 2vw rgba(0,0,0,0.6);
    }

    h2 {
      text-align: center;
      color: #ff6f61;
      font-size: 6vw;
    }

    #status {
      text-align: center;
      margin: 5vw 0;
      font-size: 4vw;
    }

    .spinner {
      border: 0.8vw solid rgba(255,255,255,0.1);
      border-top: 0.8vw solid #ff6f61;
      border-radius: 50%;
      width: 12vw;
      height: 12vw;
      animation: spin 1s linear infinite;
      margin: 5vw auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #question {
      margin-top: 8vw;
      padding: 5vw;
      background: #2e2e2e;
      border-radius: 2vw;
    }

    #question h3 {
      font-size: 5vw;
      margin-bottom: 4vw;
    }

    .option {
      background: #333;
      margin: 3vw 0;
      padding: 3vw 5vw;
      border-radius: 2vw;
      cursor: pointer;
      font-size: 4vw;
      transition: background 0.3s;
    }

    .option:hover {
      background: #444;
    }

    #leaderboard, #answers {
      margin-top: 5vw;
      background: #292929;
      padding: 4vw;
      border-radius: 2vw;
    }

    #leaderboard h4 {
      font-size: 5vw;
      margin-bottom: 4vw;
      text-align: center;
    }

    #leaderboard-list {
      list-style: none;
      padding-left: 0;
      font-size: 4vw;
    }

    @media (min-width: 768px) {
      body {
        padding: 40px;
      }

      #quiz-room {
        padding: 30px;
        border-radius: 15px;
      }

      h2 {
        font-size: 2rem;
      }

      #status {
        font-size: 1.2rem;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 6px solid rgba(255,255,255,0.1);
        border-top: 6px solid #ff6f61;
      }

      #question {
        padding: 20px;
      }

      #question h3 {
        font-size: 1.5rem;
      }

      .option {
        padding: 12px 20px;
        font-size: 1rem;
      }

      #leaderboard, #answers {
        padding: 15px;
      }

      #leaderboard h4 {
        font-size: 1.5rem;
      }

      #leaderboard-list {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div id="quiz-room">
    <h2>Welcome to the Quiz Room</h2>

    <div id="status">Connecting to the lobby...</div>
    <div class="spinner" id="lobby-spinner"></div>

    <div id="question" style="display:none;">
      <h3 id="question-text"></h3>
      <div id="options-container"></div>
    </div>

    <div id="leaderboard" style="display:none;">
      <h4>Leaderboard</h4>
      <ul id="leaderboard-list"></ul>
    </div>
  </div>

  <script>
    const ws = new WebSocket('ws://' + window.location.host + '/ws/quizroom/');

    const status = document.getElementById("status");
    const spinner = document.getElementById("lobby-spinner");
    const questionBox = document.getElementById("question");
    const questionText = document.getElementById("question-text");
    const optionsContainer = document.getElementById("options-container");
    const leaderboard = document.getElementById("leaderboard");
    const leaderboardList = document.getElementById("leaderboard-list");

    ws.onmessage = (e) => {
      const data = JSON.parse(e.data);

      if (data.state_message === "active_question") {
        status.innerText = "Question is live!";
        spinner.style.display = "none";
      } else if (data.state_message === "wait_for_next") {
        status.innerText = "Waiting for next question...";
        spinner.style.display = "block";
        questionBox.style.display = "none";
      } else if (data.question_data) {
        const q = data.question_data;
        questionText.innerText = q.question;
        optionsContainer.innerHTML = "";
        q.options.forEach((opt, idx) => {
          const btn = document.createElement("div");
          btn.className = "option";
          btn.innerText = `${String.fromCharCode(65+idx)}. ${opt}`;
          btn.onclick = () => {
            ws.send(JSON.stringify({quiz_response: String.fromCharCode(65+idx)}));
            status.innerText = "Answer submitted!";
          };
          optionsContainer.appendChild(btn);
        });
        questionBox.style.display = "block";
        spinner.style.display = "none";
      } else if (data.quiz_closed === "end") {
        status.innerText = "Quiz Finished! Final Scores:";
        leaderboard.style.display = "block";
        leaderboardList.innerHTML = "";
        data.final_standings.forEach((entry) => {
          const li = document.createElement("li");
          li.textContent = entry.username + ": " + entry.score;
          leaderboardList.appendChild(li);
        });
      }
    };

    ws.onopen = () => {
      status.innerText = "Connected to quiz room.";
    };

    ws.onclose = () => {
      status.innerText = "Disconnected.";
      spinner.style.display = "none";
    };
  </script>
</body>
</html>